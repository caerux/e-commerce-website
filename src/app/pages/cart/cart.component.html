<div class="container mt-5 pt-3 mb-3">
  <div class="row mt-3 rounded justify-content-center mx-2">
    <!-- Cart Items -->
    <div
      class="col-12 col-lg-8 border px-3 rounded mb-4 mb-lg-0 pt-3"
      *ngIf="cartItems.length > 0; else emptyCart"
    >
      <div class="d-flex justify-content-between align-items-center flex-wrap">
        <div class="fs-3 mb-2 mb-md-0">Your Cart</div>
        <button class="btn btn-outline-danger" (click)="confirmClearCart()">
          <i class="bi bi-trash"></i> Clear Cart
        </button>
      </div>
      <hr />
      <div>
        <!-- Cart Items Loop -->
        <div
          *ngFor="let item of cartItems"
          class="d-flex flex-column flex-md-row mb-5 align-items-center align-items-md-start"
        >
          <div class="me-md-4 mb-3 mb-md-0 text-center image-div">
            <a [routerLink]="['/product', item.product.barcode]">
              <img
                [src]="item.product.searchImage"
                [alt]="item.product.name"
                class="img-fluid rounded item-image"
              />
            </a>
          </div>
          <div class="flex-grow-1 text-center text-md-start">
            <h5>{{ item.product.brand }}</h5>
            <div class="product-name">{{ item.product.name }}</div>
            <p class="text-muted mb-1">Color - {{ item.product.color }}</p>
            <div
              class="d-flex flex-row align-items-center justify-content-center justify-content-md-start mb-2"
            >
              <!-- Price Section -->
              <div class="me-2 fs-5">
                <strong>{{
                  item.product.price | currency : "INR" : "symbol" : "1.0-0"
                }}</strong>
              </div>
              <div>
                <span
                  class="text-decoration-line-through text-muted me-2 small"
                >
                  {{ item.product.mrp | currency : "INR" : "symbol" : "1.0-0" }}
                </span>
                <span class="text-success">
                  {{ item.product.discountDisplayLabel }}
                </span>
              </div>
            </div>

            <!-- Quantity Controls and Remove Button -->
            <div
              class="d-flex flex-row align-items-center justify-content-center justify-content-md-start"
            >
              <div
                class="quantity-controls border d-flex align-items-center me-0 me-3 rounded"
              >
                <button
                  class="btn quantity-button btn-md"
                  (click)="decreaseQuantity(item)"
                >
                  -
                </button>
                <span class="mx-3 quantity-text">{{ item.quantity }}</span>
                <button
                  class="btn quantity-button btn-md"
                  (click)="increaseQuantity(item)"
                >
                  +
                </button>
              </div>
              <button
                class="btn btn-outline-danger"
                (click)="confirmRemoveItem(item)"
              >
                <i class="bi bi-trash"></i> Remove
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Order Summary -->
    <div class="col-12 col-lg-4" *ngIf="cartItems.length > 0">
      <div class="order-summary sticky-top p-3 border rounded">
        <h4>Order Summary</h4>
        <hr />
        <div class="d-flex justify-content-between">
          <p>Total MRP:</p>
          <p>{{ totalMRP | currency : "INR" : "symbol" : "1.0-0" }}</p>
        </div>
        <div class="d-flex justify-content-between">
          <p>Discount on MRP:</p>
          <p class="text-success">
            - {{ discountAmount | currency : "INR" : "symbol" : "1.0-0" }}
          </p>
        </div>

        <div class="d-flex justify-content-between">
          <p>Shipping:</p>
          <p>
            <span>{{
              shippingCost === 0
                ? "Free"
                : (shippingCost | currency : "INR" : "symbol" : "1.0-0")
            }}</span>
          </p>
        </div>
        <hr />
        <div class="d-flex justify-content-between">
          <h5>Total Amount:</h5>
          <h5>{{ finalAmount | currency : "INR" : "symbol" : "1.0-0" }}</h5>
        </div>
        <button
          class="btn btn-success w-100 mt-3"
          (click)="proceedToCheckout()"
        >
          Proceed to Checkout
        </button>
      </div>
    </div>
  </div>

  <!-- Confirm Clear Cart Modal -->
  <app-confirm-modal
    *ngIf="showConfirmModal"
    [title]="'Clear Cart'"
    [message]="'Are you sure you want to clear the cart?'"
    (confirm)="onConfirmClearCart()"
    (cancel)="onCancelClearCart()"
  ></app-confirm-modal>

  <!-- Confirm Remove Item Modal -->
  <app-confirm-modal
    *ngIf="showItemRemoveModal"
    [title]="'Remove Item'"
    [message]="'Are you sure you want to remove this item from the cart?'"
    (confirm)="onConfirmRemoveItem()"
    (cancel)="onCancelRemoveItem()"
  ></app-confirm-modal>

  <!-- Empty Cart Template -->
  <ng-template #emptyCart>
    <div
      class="d-flex flex-column align-items-center justify-content-center"
      style="min-height: 70vh"
    >
      <i class="bi bi-bag empty-cart" style="font-size: 5rem"></i>
      <h3>Hey, it feels so light!</h3>
      <p class="text-muted">
        There is nothing in your bag. Let's add some items.
      </p>
      <a class="btn btn-primary mt-3" [routerLink]="['/home']"
        >Start shopping</a
      >
    </div>
  </ng-template>
</div>
